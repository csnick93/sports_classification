---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.6.0
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
# !pip install voila
# !jupyter serverextension enable voila --sys-prefix
```

```{python}
from fastai.learner import load_learner
from fastai.vision.core import PILImage
import ipywidgets as widgets
```

```{python}
model_file = 'models/True_224_10_resnet34.pkl'
learner = load_learner(model_file)
```

```{python}
btn_upload = widgets.FileUpload()
```

```{python}
out_pl = widgets.Output()
lbl_pred = widgets.Label()
btn_run = widgets.Button(description='Classify')
```

```{python}
def on_click_classify(change):
    img = PILImage.create(btn_upload.data[-1])
    out_pl.clear_output()
    with out_pl:
        display(img.to_thumb(224,224))
    pred, pred_idx, probs = learner.predict(img)
    lbl_pred.value = f'Prediction: {pred}; Probability: {probs[pred_idx]:.04f}'
```

```{python}
btn_run.on_click(on_click_classify)
```

```{python}
widgets.VBox([widgets.Label('Select a sports image!'), btn_upload, btn_run, out_pl, lbl_pred])
```

```{python}

```
